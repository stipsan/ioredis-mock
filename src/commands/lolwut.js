import { coerce } from 'semver'

import { convertStringToBuffer } from '../commands-utils/convertStringToBuffer'

// schotter, plotter on paper, by Georg Nees
async function version5(redisVersion) {
  // Using lolwut version 5 20 10
  return `â¢°â ’â¢²â ’â¢²â ’â£¶â ’â¡–â¢²â¡–â¢²â ’â£¶â ’â¡–â ’â¡–â ’â¡†
  â¢¸â ’â¢ºâ ’â¢ºâ ’â£¿â ’â¡—â¢ºâ¡—â¢ºâ ’â£¿â ’â¡—â ’â¡—â ’â¡‡
  â¡žâ ’â£¾â£›â£»â£›â£¿â¢»â¡Ÿâ¢»â ›â£¿â¢»â¡Ÿâ¢»â “â¢²â£—â£’â¡‡
  â£»â ¿â£¿â£‰â£¯â£¹â£â£¹â£¯â£¹â£â£¹â£‰â£¿â¢¹â£Ÿâ£»â£“â£ºâ ƒ
  â£Œâ£‰â£¿â ­â£§â£¸â£â£¹â£¯â£¯â£¯â£¯â£½â£¯â£¿â£‰â£¹â£„â£¸â €
  â£¯â£â£¿â£­â£½â£¼â£¼â¡¼â£¿â£¬â£‡â£¹â¡®â£¿â£»â£—â£½â£’â¡¼â¡…
  â¢—â£‰â¢¿â£¦â£¿â£¿â£§â¢·â£·â£¯â£§â£Ÿâ£·â£¾â£¼â£—â£¿â¢—â£¹â¢‡
  â¢³â žâ¢ºâ ¶â£¿â ¾â£Ÿâ£»â£¾â Ÿâ¢·â£Ÿâ¢¾â¢·â£¿â£“â¢§â¡§â ´â¡Ž
  â¡¼â ¶â¡žâ¢’â¡¾â ¾â¡â¢²â¡·â¡½â¢¾â£¿â¢¼â£¾â¢¿â ’â£¾â¡¿â ¶â¡§
  â¢·â ¶â£·â£ºâ¢·â£¹â¢Ÿâ£²â¢«â ·â¡¯â¢¿â¢½â¢¿â¢¾â¡Ÿâ¢ºâ¢³â¢²â 
  â¡¸â ºâ¡ºâ£ºâ¡»â¢¾â žâ¢›â¢¶â¡»â¢žâ ¾â£¹â¢¿â£¾â ™â£»â ›â ºâ¡€
  â ˆâ ¢â Šâ šâ ’â šâ ‘â ”â ‘â œâ £â ›â ¼â ¥â ¼â ‰â ‹â ¢â Šâ €
  
  Georg Nees - schotter, plotter on paper, 1968. Redis ver. ${redisVersion}`
}

// Plaguemon by hikimori
function version6(redisVersion) {
  // Using lolwut version 6 20 10
  return `[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m
[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m
[0;97;107m [0m[0;97;107m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m[0;97;107m [0m
[0;97;107m [0m[0;97;107m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;97;107m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m
[0;97;107m [0m[0;97;107m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m
[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;37;47m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m
[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;37;47m [0m[0;37;47m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;30;40m [0m[0;30;40m [0m
[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;37;47m [0m[0;37;47m [0m[0;30;40m [0m[0;30;40m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;37;47m [0m[0;37;47m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;30;40m [0m[0;30;40m [0m
[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;37;47m [0m[0;37;47m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;30;40m [0m[0;30;40m [0m
[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;30;40m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;37;47m [0m[0;37;47m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;90;100m [0m[0;30;40m [0m[0;30;40m [0m
Dedicated to the 8 bit game developers of past and present.
Original 8 bit image from Plaguemon by hikikomori. Redis ver. ${redisVersion}`
}

// eslint-disable-next-line default-param-last
export async function lolwut(VERSION = 'VERSION', version) {
  const json = await import('../../data/info.json')
  const data = json.default || json
  const redisRawVersion = data
    .split('\n')
    .find(line => line.indexOf('redis_version') !== -1)
  const redisVersion = coerce(redisRawVersion).version

  if (VERSION && VERSION.toUpperCase() !== 'VERSION') {
    throw new Error('ERR value is not an integer or out of range')
  }

  // eslint-disable-next-line eqeqeq
  if (version == 6) {
    return version6(redisVersion)
  }

  // eslint-disable-next-line eqeqeq
  if (version == 5) {
    return version5(redisVersion)
  }

  return `Redis ver. ${redisVersion}
`
}

export async function lolwutBuffer(...args) {
  const val = await lolwut.apply(this, args)
  return convertStringToBuffer(val)
}
